<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home</title>

    <script>
        function load() {
            setInterval(listMsgs, 1000);
            document.getElementById("date").valueAsDate = new Date();
            calendar();
            fetch("http://localhost:2000/svatky").then(function (response) {
                response.text().then(function (text) {
                    let obj = JSON.parse(text);
                    document.getElementById("svatek").innerHTML = obj.jmeno;
                    document.getElementById("datum").innerHTML = obj.den + "/" + obj.mesic + "/" + obj.rok;
                    document.getElementById("zitra").innerHTML = obj.zitraDen + "/" + obj.zitraMesic + "/" + obj.zitraRok;
                    document.getElementById("svatekZ").innerHTML = obj.jmenoZitra;
                });
            });
        }

        function calendar() {
            let d = document.getElementById("date").valueAsDate;
            fetch("http://localhost:2000/svatky?d=" + d.getDate() + "&m=" + (d.getMonth() + 1)).then(function (response) {
                response.text().then(function (text) {
                    let obj = JSON.parse(text);
                    document.getElementById("name").innerHTML = obj.svatek;
                });
            });
        }

        function send() {
            let chatmsg = document.getElementById("chatInput").value;
            let user = document.getElementById("user").innerHTML;
            fetch("http://localhost:2000/chat/addmsg?msg=" + chatmsg + "&user=" + user).then(function (response) {
                response.text().then(function (text) {

                });
            });
            document.getElementById("chatInput").value = "";
        }

        function listMsgs() {
            fetch("http://localhost:2000/chat/listmsgs").then(function (response) {
                response.text().then(function (text) {
                     let obj = JSON.parse(text);
                     let s = "";
                     for(let o of obj.messages) {
                         s = s+ o.date + " v " + o.time + "<br>" + o.user + ":   <b>" + o.text + "</b><br><br>";
                     }
                     document.getElementById("msgs").innerHTML = s;
                });
            });
        }

        function setUser() {
            document.getElementById("user").innerHTML = document.getElementById("prezdivka").value;
            document.getElementById("prezdivka").value="";
        }
    </script>
</head>
<body onload="load()">

<h1>aplikace</h1>

Dnes je <b id="datum">...</b>, svátek má <b id="svatek">...</b>.
<br>
Zítra bude <b id="zitra"></b>, svátek bude mít <b id="svatekZ"></b>.

<br><br>
<input type="date" id="date" onchange="calendar()"> má svátek <b id="name">...</b>.
<br><br>

<img src="obrazek.jpg">
<br><br>
<br><br>
<h1>chat</h1>
<b>Moje přezdívka: </b><i><b id="user"></b></i>
<br><br>
<div id="msgs"></div>
<input type="text" id="chatInput"><input type="button" value="odesli" onclick="send()">
<input type="text" id="prezdivka" placeholder="přezdívka"><input type="button" value="nastavit" onclick="setUser()">

</body>
</html>